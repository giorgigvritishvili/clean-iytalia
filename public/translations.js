const translations = {
  en: {
    nav: {
      services: "Services",
      book: "Book Now",
      faq: "FAQ",
      contact: "Contact"
    },
    hero: {
      title: "Professional Cleaning Services in Italy",
      subtitle: "Trusted, reliable cleaning for your home or business. Serving Rome and Milan.",
      cta: "Book Now",
      feature1: "Trusted Professionals",
      feature2: "Flexible Scheduling",
      feature3: "Secure Payment"
    },
    services: {
      title: "Our Services",
      subtitle: "Choose the perfect cleaning service for your needs",
      regular: "Regular Cleaning",
      regularDesc: "Weekly or bi-weekly cleaning for homes",
      onetime: "One-time Cleaning",
      onetimeDesc: "Single deep clean for any occasion",
      deep: "Deep Cleaning",
      deepDesc: "Thorough cleaning including hard-to-reach areas",
      move: "Move-in/Move-out",
      moveDesc: "Complete cleaning for moving in or out",
      lastminute: "Last-minute Cleaning",
      lastminuteDesc: "Urgent cleaning service within 24 hours",
      business: "Business Cleaning",
      businessDesc: "Professional cleaning for offices and businesses",
      perHour: "/hour"
    },
    booking: {
      title: "Book Your Cleaning",
      subtitle: "Fill in the details below to schedule your service",
      step1: "Select Service & Location",
      step2: "Select Date & Time",
      step3: "Your Details",
      step4: "Review & Pay",
      service: "Service Type",
      selectService: "Select a service",
      city: "City",
      selectCity: "Select a city",
      hours: "Hours",
      cleaners: "Cleaners",
      date: "Date",
      time: "Time",
      selectDate: "Select a date first",
      noSlots: "No available time slots",
      errorSlots: "Error loading slots",
      name: "Full Name",
      email: "Email",
      phone: "Phone",
      address: "Address",
      notes: "Special Instructions (Optional)",
      next: "Next",
      back: "Back",
      total: "Total:",
      paymentNotice: "Your card will be authorized but not charged until your booking is confirmed by our team.",
      confirm: "Confirm Booking",
      summary: {
        service: "Service",
        city: "City",
        date: "Date",
        time: "Time",
        duration: "Duration",
        hours: "hours",
        cleaners: "Cleaners",
        address: "Address",
      },
      validation: {
        selectService: "Please select a service",
        selectCity: "Please select a city",
        selectDate: "Please select a date",
        selectTime: "Please select a time",
        fillAllFields: "Please fill in all required fields",
        validEmail: "Please enter a valid email",
        bookingError: "Error creating booking. Please try again."
      }
    },
    success: {
      title: "Booking Submitted!",
      message: "Your booking is pending confirmation. We will notify you via email once it's confirmed.",
      payment: "Your payment has been authorized and will only be charged upon confirmation.",
      newBooking: "Make Another Booking"
    },
    faq: {
      title: "Frequently Asked Questions",
      q1: "How does the booking process work?",
      a1: "Simply select your service, choose a date and time, enter your details, and complete the payment authorization. Your card will only be charged once we confirm your booking.",
      q2: "What areas do you serve?",
      a2: "We currently serve Rome and Milan. More cities coming soon!",
      q3: "What payment methods do you accept?",
      a3: "We accept all major credit and debit cards through our secure Stripe payment system.",
      q4: "Can I cancel my booking?",
      a4: "If your booking hasn't been confirmed yet, no charge will be made. For confirmed bookings, please contact us at least 24 hours in advance."
    },
    contact: {
      title: "Contact Us",
      subtitle: "Have questions? We're here to help!",
      email: "Email",
      phone: "Phone",
      whatsapp: "Chat with us"
    },
    footer: {
      privacy: "Privacy Policy",
      terms: "Terms of Service",
      cookies: "Cookie Policy"
    },
    cookies: {
      message: "We use cookies to improve your experience. By continuing to use this site, you agree to our use of cookies.",
      accept: "Accept",
      decline: "Decline"
    }
  },
  it: {
    nav: {
      services: "Servizi",
      book: "Prenota Ora",
      faq: "FAQ",
      contact: "Contatti"
    },
    hero: {
      title: "Servizi di Pulizia Professionali in Italia",
      subtitle: "Pulizia affidabile per la tua casa o azienda. Serviamo Roma e Milano.",
      cta: "Prenota Ora",
      feature1: "Professionisti Affidabili",
      feature2: "Orari Flessibili",
      feature3: "Pagamento Sicuro"
    },
    services: {
      title: "I Nostri Servizi",
      subtitle: "Scegli il servizio di pulizia perfetto per le tue esigenze",
      perHour: "/ora"
    },
    booking: {
      title: "Prenota la Tua Pulizia",
      subtitle: "Compila i dettagli per programmare il tuo servizio",
      step1: "Seleziona Servizio e Località",
      step2: "Seleziona Data e Ora",
      step3: "I Tuoi Dati",
      step4: "Riepilogo e Pagamento",
      service: "Tipo di Servizio",
      selectService: "Seleziona un servizio",
      city: "Città",
      selectCity: "Seleziona una città",
      hours: "Ore",
      cleaners: "Addetti",
      date: "Data",
      time: "Ora",
      selectDate: "Seleziona prima una data",
      noSlots: "Nessun orario disponibile",
      errorSlots: "Errore nel caricamento degli orari",
      name: "Nome Completo",
      email: "Email",
      phone: "Telefono",
      address: "Indirizzo",
      notes: "Istruzioni Speciali (Opzionale)",
      next: "Avanti",
      back: "Indietro",
      total: "Totale:",
      paymentNotice: "La tua carta sarà autorizzata ma non addebitata fino alla conferma della prenotazione.",
      confirm: "Conferma Prenotazione",
      summary: {
        service: "Servizio",
        city: "Città",
        date: "Data",
        time: "Ora",
        duration: "Durata",
        hours: "ore",
        cleaners: "Addetti",
        address: "Indirizzo"
      },
      validation: {
        selectService: "Seleziona un servizio",
        selectCity: "Seleziona una città",
        selectDate: "Seleziona una data",
        selectTime: "Seleziona un orario",
        fillAllFields: "Compila tutti i campi richiesti",
        validEmail: "Inserisci un indirizzo email valido",
        bookingError: "Errore durante la prenotazione. Riprova."
      }
    },
    success: {
      title: "Prenotazione Inviata!",
      message: "La tua prenotazione è in attesa di conferma. Ti avviseremo via email.",
      payment: "Il pagamento è stato autorizzato e verrà addebitato solo dopo la conferma.",
      newBooking: "Fai un'altra Prenotazione"
    },
    faq: {
      title: "Domande Frequenti",
      q1: "Come funziona il processo di prenotazione?",
      a1: "Seleziona il servizio, scegli data e ora, inserisci i tuoi dati e completa l'autorizzazione. La carta verrà addebitata solo dopo la conferma.",
      q2: "Quali zone servite?",
      a2: "Attualmente serviamo Roma e Milano. Altre città in arrivo!",
      q3: "Quali metodi di pagamento accettate?",
      a3: "Accettiamo tutte le principali carte di credito e debito tramite Stripe.",
      q4: "Posso cancellare la prenotazione?",
      a4: "Se non è stata confermata, nessun addebito. Per prenotazioni confermate, contattaci almeno 24 ore prima."
    },
    contact: {
      title: "Contattaci",
      subtitle: "Hai domande? Siamo qui per aiutarti!",
      email: "Email",
      phone: "Telefono",
      whatsapp: "Chatta con noi"
    },
    footer: {
      privacy: "Privacy Policy",
      terms: "Termini di Servizio",
      cookies: "Cookie Policy"
    },
    cookies: {
      message: "Utilizziamo i cookie per migliorare la tua esperienza. Continuando a usare il sito, accetti l'uso dei cookie.",
      accept: "Accetta",
      decline: "Rifiuta"
    }
  }
};

let currentLanguage = localStorage.getItem('language') || 'en';

function setLanguage(lang) {
  currentLanguage = lang;
  localStorage.setItem('language', lang);

  const langSwitcher = document.getElementById('current-lang');
  if (langSwitcher) {
    langSwitcher.textContent = lang.toUpperCase();
  }
  
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    const keys = key.split('.');
    let value = translations[lang];
    
    try {
      for (const k of keys) {
        value = value[k];
      }
      
      if (typeof value === 'string') {
        // Use textContent for most elements
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
          element.placeholder = value;
        } else {
          element.textContent = value;
        }
      }
    } catch (error) {
      // If a key is not found, do nothing, leave the default text
    }
  });
}

function toggleLanguage(callback) {
  const newLang = currentLanguage === 'en' ? 'it' : 'en';
  setLanguage(newLang);
  if (typeof callback === 'function') {
    callback();
  }
}

function initTranslations(callback) {
  const langSwitchBtn = document.getElementById('lang-switch-btn');
  if (langSwitchBtn) {
    langSwitchBtn.addEventListener('click', () => toggleLanguage(callback));
  }
  setLanguage(currentLanguage);
}

// Helper function to get a translated string
function i18n(key) {
  const keys = key.split('.');
  let value = translations[currentLanguage];
  try {
    for (const k of keys) {
      value = value[k];
    }
    return typeof value === 'string' ? value : key;
  } catch (error) {
    return key;
  }
}
